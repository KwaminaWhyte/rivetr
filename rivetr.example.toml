# Rivetr Configuration Example
# Copy this file to rivetr.toml and customize

[server]
host = "0.0.0.0"
api_port = 8080
proxy_port = 80
proxy_https_port = 443
data_dir = "./data"

[auth]
# API token for programmatic access (generate a secure token for production!)
admin_token = "change-me-in-production"

[runtime]
# Options: "auto", "docker", "podman"
runtime_type = "auto"
# Docker socket path (Linux default shown)
docker_socket = "/var/run/docker.sock"
# Build resource limits - prevent builds from consuming all system resources
# CPU limit for builds (e.g., "2" for 2 CPUs, "0.5" for half a CPU). Default: "2"
build_cpu_limit = "2"
# Memory limit for builds (e.g., "2g" for 2GB, "512m" for 512MB). Default: "2g"
build_memory_limit = "2g"

[proxy]
# Enable automatic HTTPS with Let's Encrypt
acme_enabled = false
# Email for Let's Encrypt account registration (required if acme_enabled = true)
# acme_email = "admin@example.com"
# Use Let's Encrypt staging environment for testing (avoids rate limits)
acme_staging = true
# Directory to store ACME account and certificates
acme_cache_dir = "./data/acme"
# Health check settings
health_check_interval = 30
health_check_timeout = 5
health_check_threshold = 3
# Base domain for auto-generated app subdomains (e.g., "rivetr.example.com")
# Apps will automatically get subdomains like "my-app.rivetr.example.com"
# base_domain = "rivetr.example.com"
# Enable automatic subdomain generation for new apps (requires base_domain)
auto_subdomain_enabled = false
# Enable sslip.io automatic domains (generates domains like abc123.192.168.1.1.sslip.io)
# This provides free wildcard DNS for any IP address without custom DNS setup
sslip_enabled = true
# Server's public IP address for sslip.io domain generation
# If not set, you'll need to configure it for sslip.io to work
# server_ip = "192.168.1.100"

[logging]
# Options: "trace", "debug", "info", "warn", "error"
level = "info"

[webhooks]
# Webhook secrets for signature verification (optional but recommended)
# GitHub: Used to verify X-Hub-Signature-256 header (HMAC-SHA256)
# github_secret = "your-github-webhook-secret"
# GitLab: Token to match X-Gitlab-Token header
# gitlab_token = "your-gitlab-webhook-token"
# Gitea: Used to verify X-Gitea-Signature header (HMAC-SHA256)
# gitea_secret = "your-gitea-webhook-secret"

[rate_limit]
# Enable rate limiting (default: true)
enabled = true
# Requests per window for general API endpoints (default: 100)
api_requests_per_window = 100
# Requests per window for webhook endpoints (default: 500)
webhook_requests_per_window = 500
# Requests per window for auth endpoints - stricter to prevent brute force (default: 20)
auth_requests_per_window = 20
# Window duration in seconds (default: 60)
window_seconds = 60
# Cleanup interval for expired rate limit entries in seconds (default: 300)
cleanup_interval = 300

[cleanup]
# Enable automatic cleanup of old deployments (default: true)
enabled = true
# Maximum number of deployments to keep per app (default: 10)
# Older deployments will be removed, along with their containers and images
max_deployments_per_app = 10
# Interval between cleanup runs in seconds (default: 3600 = 1 hour)
cleanup_interval_seconds = 3600
# Prune unused/dangling Docker/Podman images after cleanup (default: true)
# This helps reclaim disk space from orphaned image layers
prune_images = true

[disk_monitor]
# Enable disk space monitoring (default: true)
# Monitors the data directory's filesystem and exposes metrics via Prometheus
enabled = true
# Interval between disk space checks in seconds (default: 300 = 5 minutes)
check_interval_seconds = 300
# Disk usage percentage threshold for warning logs (default: 80)
# A warning will be logged when disk usage exceeds this percentage
warning_threshold = 80
# Disk usage percentage threshold for critical logs (default: 90)
# A critical error will be logged when disk usage exceeds this percentage
critical_threshold = 90

[container_monitor]
# Enable container crash monitoring and auto-restart (default: true)
# When enabled, crashed containers will be automatically restarted with exponential backoff
enabled = true
# Interval between container health checks in seconds (default: 30)
check_interval_secs = 30
# Maximum number of restart attempts before giving up (default: 5)
# After this many failed restarts, the deployment will be marked as failed
max_restart_attempts = 5
# Initial backoff delay in seconds after a crash (default: 5)
# Each subsequent restart doubles this delay until max_backoff_secs is reached
initial_backoff_secs = 5
# Maximum backoff delay in seconds (default: 300 = 5 minutes)
max_backoff_secs = 300
# Duration in seconds a container must run before being considered stable (default: 120)
# After this duration without crashing, the restart counter is reset
stable_duration_secs = 120
